{
  "configVersion": "1.0.0",
  "lastModified": "2024-12-21T10:00:00.000Z",
  "awsSdkVersion": "@aws-sdk/client-ec2@3.893.0",
  "resourceType": "VPC",
  "cloudProvider": "AWS",
  "dependencies": [],
  "serviceMapping": {
    "serviceName": "ec2",
    "packageName": "@aws-sdk/client-ec2",
    "clientClass": "EC2Client"
  },
  "schema": {
    "properties": [
      {
        "name": "cidrBlock",
        "type": "string",
        "description": "The IPv4 network range for the VPC, in CIDR notation",
        "validation": {
          "pattern": "^(\\d{1,3}\\.){3}\\d{1,3}/\\d{1,2}$"
        }
      },
      {
        "name": "enableDnsHostnames",
        "type": "boolean",
        "description": "Indicates whether instances launched in the VPC get DNS hostnames"
      },
      {
        "name": "enableDnsSupport",
        "type": "boolean",
        "description": "Indicates whether the DNS resolution is supported for the VPC"
      },
      {
        "name": "tags",
        "type": "object",
        "description": "A map of tags to assign to the resource"
      }
    ],
    "required": [
      "cidrBlock"
    ]
  },
  "operations": {
    "create": [
      {
        "command": "CreateVpcCommand",
        "description": "Create the VPC with specified CIDR block",
        "parameters": {
          "CidrBlock": "{{config.cidrBlock}}"
        },
        "outputMapping": {
          "resourceId": "Vpc.VpcId",
          "vpcId": "Vpc.VpcId",
          "cidrBlock": "Vpc.CidrBlock",
          "state": "Vpc.State"
        }
      },
      {
        "command": "CreateTagsCommand",
        "description": "Add tags to the VPC if specified",
        "condition": "{{if(config.tags, true, false)}}",
        "parameters": {
          "Resources": [
            "{{outputs.vpcId}}"
          ],
          "Tags": "{{transformTags(config.tags)}}"
        }
      },
      {
        "command": "ModifyVpcAttributeCommand",
        "description": "Enable DNS hostnames if specified",
        "condition": "{{config.enableDnsHostnames}}",
        "parameters": {
          "VpcId": "{{outputs.vpcId}}",
          "EnableDnsHostnames": {
            "Value": true
          }
        }
      },
      {
        "command": "ModifyVpcAttributeCommand",
        "description": "Enable DNS support if specified",
        "condition": "{{config.enableDnsSupport}}",
        "parameters": {
          "VpcId": "{{outputs.vpcId}}",
          "EnableDnsSupport": {
            "Value": true
          }
        }
      }
    ],
    "read": {
      "command": "DescribeVpcsCommand",
      "description": "Retrieve VPC information",
      "parameters": {
        "VpcIds": [
          "{{resourceId}}"
        ]
      },
      "outputMapping": {
        "vpcId": "Vpcs.0.VpcId",
        "cidrBlock": "Vpcs.0.CidrBlock",
        "state": "Vpcs.0.State",
        "isDefault": "Vpcs.0.IsDefault",
        "dhcpOptionsId": "Vpcs.0.DhcpOptionsId"
      }
    },
    "delete": {
      "command": "DeleteVpcCommand",
      "description": "Delete the VPC",
      "parameters": {
        "VpcId": "{{resourceId}}"
      }
    }
  },
  "validation": {
    "required": [
      "cidrBlock"
    ],
    "custom": [
      {
        "field": "cidrBlock",
        "rule": "cidr",
        "message": "Invalid CIDR block format. Must be in format x.x.x.x/x",
        "params": {
          "allowPrivate": true,
          "allowPublic": false
        }
      }
    ]
  },
  "errorHandling": {
    "InvalidVpcID.NotFound": "VPC {{resourceId}} not found in region {{context.region}}",
    "InvalidVpcID.Malformed": "Invalid VPC ID format: {{resourceId}}",
    "VpcLimitExceeded": "VPC limit exceeded in region {{context.region}}. Contact AWS support to increase limits.",
    "InvalidVpc.Range": "The CIDR '{{config.cidrBlock}}' is invalid or conflicts with existing VPCs",
    "DependencyViolation": "Cannot delete VPC {{resourceId}} - it has dependent resources (subnets, internet gateways, etc.)",
    "InvalidParameterValue": "Invalid parameter value provided for VPC creation",
    "UnauthorizedOperation": "Insufficient permissions to perform VPC operations in region {{context.region}}"
  },
  "relationships": [
    {
      "key": "vpc.subnets",
      "from": "VPC",
      "to": "Subnet",
      "kind": "contains",
      "cardinality": "1:N",
      "required": false,
      "description": "VPC can contain multiple Subnets (inverse of Subnet→VPC relationship)",
      "inverse": true,
      "policies": {
        "delete": "restrict"
      }
    },
    {
      "key": "vpc.internetgateways",
      "from": "VPC",
      "to": "InternetGateway",
      "kind": "attached_to",
      "cardinality": "1:1",
      "required": false,
      "description": "VPC can have Internet Gateways attached (inverse of IGW→VPC relationship)",
      "inverse": true,
      "policies": {
        "delete": "detach"
      }
    }
  ],
  "resourceForm": [
    {
      "category": "Basic Information",
      "fields": [
        {
          "name": "cidrBlock",
          "label": "CIDR Block",
          "type": "string",
          "fieldType": "text-input",
          "description": "The IPv4 network range for the VPC, in CIDR notation",
          "validation": {
            "pattern": "/^(?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d))\\.){3}(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\/(3[0-2]|[12]\\d|[0-9]))$/",
            "required": true
          },
          "defaultValue": "10.0.0.0/16"
        },
        {
          "name": "enableDnsHostnames",
          "label": "Enable DNS Hostnames",
          "type": "boolean",
          "fieldType": "checkbox",
          "description": "Indicates whether instances launched in the VPC get DNS hostnames",
          "validation": {
            "required": true
          },
          "defaultValue": false
        },
        {
          "name": "enableDnsSupport",
          "label": "Enable DNS Support",
          "type": "boolean",
          "fieldType": "checkbox",
          "description": "Indicates whether the DNS resolution is supported for the VPC",
          "validation": {
            "required": true
          },
          "defaultValue": false
        }
      ]
    },
    {
      "category": "Array of Tags",
      "fields": [
        {
          "name": "tags",
          "label": "Tags",
          "type": "array",
          "fieldType": "tags",
          "description": "A map of tags to assign to the VPC",
          "validation": {
            "required": true,
            "minLength": 1
          },
          "item": {
            "type": "object",
            "fields": [
              {
                "name": "key",
                "label": "Key",
                "type": "string",
                "validation": {
                  "required": true
                }
              },
              {
                "name": "value",
                "label": "Value",
                "type": "string",
                "validation": {
                  "required": true
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
